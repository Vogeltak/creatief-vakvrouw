{% extends "base.html" %}
{% block title %}Facturen - Creatief Vakvrouw{% endblock %}
{% block content %}
<header>
    <h2>Alle facturen</h2>
    <center><em><small>omzet excl. BTW van de afgelopen vijf maanden</small></em></center>
    <canvas id="chart"></canvas>
</header>
{% for (yearmonth, invoices) in grouped_invoices %}
<section>
    <h3>{{ yearmonth }}</h3>
    {% for f in invoices %}
    <details id="{{ f.nummer }}" class="row">
        <summary>
            <span>
                <span class="tag">{{ f.nummer }}</span>
                {{ f.client.name }}
            </span>
            <span>€{{ "{:.2}"|format(f.subtotal) }}</span>
        </summary>
        <div class="factuur-details">
            <table>
                {% for i in f.work_items %}
                <tr>
                    <td>{{ i.desc }}</td>
                    <td>€{{ i.euro }}</td>
                </tr>
                {% endfor %}
                <tr>
                    <td>BTW</td>
                    <td>€{{ "{:.2}"|format(f.btw) }}</td>
                </tr>
                <tr class="total">
                    <td>Total</td>
                    <td>€{{ "{:.2}"|format(f.total) }}</td>
                </tr>
            </table>
            Created at <span class="tag">{{ f.date|date }}</span>
        </div>
    </details>
    {% endfor %}
</section>
{% endfor %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript">
const ctx = document.getElementById('chart');

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [{% for (ym, _) in grouped_invoices %}'{{ ym }}',{% endfor %}].reverse().slice(-5, 9999),
        datasets: [{
            label: 'Omzet (ex. btw)',
            data: [
            {%- for (_, i) in grouped_invoices -%}
                {{ "{:.2}"|format(i|sum_invoices) }},
            {%- endfor -%}
            ].reverse().slice(-5, 9999),
            backgroundColor: '#f5f5f5',
            borderColor: '#888',
            borderWidth: 1,
        }]
    },
    options: {
        aspectRatio: 3,
        plugins: {
            colors: {
                enabled: true,
                forceOverride: true,
            }
        },
        scales: {
            x: {
                grid: {
                    display: false
                }
            },
            y: {
                grid: {
                    display: true
                },
                beginAtZero: true,
                suggestedMax: 3000,
            },
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
</script>
{% endblock %}
